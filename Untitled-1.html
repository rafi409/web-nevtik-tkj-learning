<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NEVTIK — TKJ Learning (Absensi + LMS)</title>
  <meta name="description" content="Platform absensi dan LMS sederhana (pilihan ganda). Works offline with localStorage.">
  <style>
    /* =========================
       THEME: MERAH BENDERA - Putih
       ========================= */
    :root{
      --red: #ff0000;
      --red-dark: #c70000;
      --bg: #ffffff;
      --muted: #f7f7f7;
      --card: #ffffff;
      --text: #111;
      --accent: #e33a3a;
    }
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; }
    html,body{height:100%;margin:0;background:var(--muted);color:var(--text);}

    /* layout */
    .app{display:flex;min-height:100vh}
    aside.sidebar{
      width:250px;background:linear-gradient(180deg,var(--red),var(--accent));
      color:#fff;padding:26px;position:fixed;left:0;top:0;bottom:0;
      box-shadow:4px 0 24px rgba(0,0,0,0.08);
    }
    aside .brand{font-weight:800;font-size:20px;line-height:1.05;margin-bottom:18px}
    .nav{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}
    .nav button{
      background:transparent;border:none;color:rgba(255,255,255,0.95);
      padding:10px 12px;text-align:left;font-weight:600;border-radius:8px;cursor:pointer;
    }
    .nav button:hover,.nav button.active{background:rgba(255,255,255,0.12)}
    .sidebar small{display:block;margin-top:18px;color:rgba(255,255,255,0.9);font-size:13px}

    main.main{
      margin-left:250px;padding:28px;flex:1;min-height:100vh;
    }

    /* hero */
    .hero{height:180px;border-radius:12px;overflow:hidden;background-image:url('https://i.ibb.co/5v8M3t4/tech-red.jpg');background-size:cover;background-position:center;position:relative;box-shadow:0 8px 30px rgba(0,0,0,0.06)}
    .hero::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.28),rgba(0,0,0,0.08));}
    .hero .txt{position:absolute;left:28px;bottom:18px;color:#fff}
    .hero h1{margin:0;font-size:24px}
    .hero p{margin:6px 0 0;opacity:0.95;font-size:13px}

    /* cards */
    .card{background:var(--card);padding:18px;border-radius:12px;border:1px solid rgba(0,0,0,0.04);box-shadow:0 8px 24px rgba(0,0,0,0.04);margin-bottom:18px}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:20px;margin-top:18px}
    @media(max-width:980px){.grid{grid-template-columns:1fr;}}
    h2{margin:0 0 10px 0}

    /* form elements */
    label{display:block;margin-top:10px;font-size:13px;color:#444}
    input[type=text],input[type=password],select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e6e6;background:#fff;font-size:14px}
    textarea{min-height:80px;resize:vertical}
    .row{display:flex;gap:10px}
    .row .col{flex:1}

    button.primary{background:var(--red);color:#fff;border:none;padding:10px 12px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;border:1px solid var(--red);color:var(--red);padding:8px 10px;border-radius:8px;cursor:pointer}
    .small{font-size:13px;padding:6px 10px;border-radius:6px}

    /* lists / tables */
    table{width:100%;border-collapse:collapse;margin-top:12px;background:#fff;border-radius:6px;overflow:hidden}
    th,td{padding:10px;border-bottom:1px solid #f2f2f2;text-align:left}
    th{background:var(--red);color:#fff}

    /* quiz */
    .soal-box{background:#fff;padding:14px;border:1px solid #f0f0f0;border-radius:10px;margin-bottom:12px}
    .choice{display:block;padding:10px;border-radius:8px;border:1px solid #eee;margin-top:8px;cursor:pointer}
    .choice input{margin-right:8px}

    /* modal (login pengajar) */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;justify-content:center;align-items:center;z-index:60}
    .modal-card{background:#fff;padding:18px;border-radius:10px;width:340px;box-shadow:0 10px 40px rgba(0,0,0,0.25)}
    .modal-card h3{margin:0 0 8px 0}
    .modal-input{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid #e6e6e6}

    /* utilities */
    .muted{color:#777;font-size:13px}
    .right{display:flex;gap:8px;justify-content:flex-end;align-items:center}
    .center{display:flex;gap:8px;align-items:center}
    .hidden{display:none}

    /* small responsive tweaks */
    @media(max-width:700px){
      aside.sidebar{display:none}
      main.main{margin-left:0;padding:16px}
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar" role="navigation" aria-label="Main">
      <div class="brand">NEVTIK<br><small style="font-weight:600">TKJ LEARNING</small></div>
      <nav class="nav" aria-label="main navigation">
        <button id="nav-beranda" class="active" onclick="nav('beranda', this)">Beranda</button>
        <button id="nav-absensi" onclick="nav('absensi', this)">Absensi</button>
        <button id="nav-pengajar" onclick="openPengajarLogin(this)">Pengajar (Buat Soal)</button>
        <button id="nav-lms" onclick="nav('lms', this)">LMS (Kerjakan Soal)</button>
        <button id="nav-admin" onclick="nav('admin', this)">Admin</button>
      </nav>
      <small>Nevtik — TKJ Learning · 2025</small>
    </aside>

    <main class="main" role="main">
      <!-- BERANDA -->
      <section id="beranda" class="view">
        <div class="hero" role="region" aria-label="Hero banner">
          <div class="txt">
            <h1>NEVTIK — TKJ LEARNING</h1>
            <p>Platform absensi & pembelajaran — Praktik cepat dan simpel.</p>
          </div>
        </div>

        <div class="grid">
          <div>
            <div class="card">
              <h2>Selamat datang Di Web Nevtik-TKJ-Learning</h2>
              <p class="muted">Gunakan menu di kiri untuk absensi, (pengajar), atau siswa yang mengerjakan soal di LMS.</p>
            </div>
          </div>

          <aside>
            <div class="card">
              <h4>Quick actions</h4>
              <div style="display:flex;flex-direction:column;gap:8px;margin-top:10px">
                <button class="primary" onclick="nav('absensi')">Isi Absensi</button>
                <button class="ghost" onclick="openPengajarLogin()">Buat Soal (Pengajar)</button>
                <button class="ghost" onclick="nav('lms')">Kerjakan Soal (LMS)</button>
              </div>
            </div>

            <div class="card" style="margin-top:12px">
              <h4>About</h4>
              <p class="muted" style="margin:0">Web Nevtik TKJ Learning ini untuk memudahkan pembelajaran Seperti Absensi dan Mengerjakan soal Quizz dengan fitur LMS.</p>
            </div>
          </aside>
        </div>
      </section>

      <!-- ABSENSI -->
      <section id="absensi" class="view hidden" aria-hidden="true">
        <div class="card">
          <h2>Form Absensi</h2>
          <div style="margin-top:10px">
            <label for="abs-nama">Nama lengkap</label>
            <input id="abs-nama" type="text" placeholder="Masukkan nama lengkap">
            <label for="abs-kelas">Kelas</label>
            <select id="abs-kelas">
              <option value="X TKJ 1">X TKJ 1</option>
              <option value="X TKJ 2">X TKJ 2</option>
              <option value="XI TKJ 1">XI TKJ 1</option>
              <option value="XI TKJ 2">XI TKJ 2</option>
            </select>

            <div style="margin-top:12px" class="center">
              <button class="primary" onclick="submitAbsensi()">Kirim Absensi</button>
              <button class="ghost" onclick="clearAbsensiForm()">Bersihkan</button>
            </div>

            <div id="abs-msg" class="muted" style="margin-top:10px" aria-live="polite"></div>
          </div>
        </div>

        <div class="card">
          <h3>Absensi Terakhir</h3>
          <div id="absensi-list" class="muted">Belum ada data</div>
        </div>
      </section>

      <!-- PENGAJAR: BUAT SOAL -->
      <section id="pengajar" class="view hidden" aria-hidden="true">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h2>Pengajar — Buat Soal (Pilihan Ganda)</h2>
            <div>
              <button id="peng-logout-btn" class="ghost hidden small" onclick="pengajarLogout()">Logout</button>
            </div>
          </div>

          <div style="margin-top:10px">
            <label for="q-text">Soal</label>
            <textarea id="q-text" placeholder="Tulis pertanyaan di sini..." rows="3"></textarea>

            <div class="row" style="margin-top:10px">
              <div class="col"><label for="q-a0">Opsi A</label><input id="q-a0" type="text" placeholder="Pilihan A"></div>
              <div class="col"><label for="q-a1">Opsi B</label><input id="q-a1" type="text" placeholder="Pilihan B"></div>
            </div>
            <div class="row">
              <div class="col"><label for="q-a2">Opsi C</label><input id="q-a2" type="text" placeholder="Pilihan C"></div>
              <div class="col"><label for="q-a3">Opsi D</label><input id="q-a3" type="text" placeholder="Pilihan D"></div>
            </div>

            <label for="q-correct" style="margin-top:10px">Jawaban Benar</label>
            <select id="q-correct">
              <option value="0">A</option>
              <option value="1">B</option>
              <option value="2">C</option>
              <option value="3">D</option>
            </select>

            <div style="margin-top:12px;display:flex;gap:8px">
              <button class="primary" onclick="addQuestion()">Tambah Soal</button>
              <button class="ghost" onclick="clearQuestionForm()">Bersihkan</button>
            </div>
            <div id="q-form-msg" class="muted" style="margin-top:8px" aria-live="polite"></div>
          </div>
        </div>

        <div class="card">
          <h3>Bank Soal</h3>
          <div id="question-list" style="max-height:360px;overflow:auto"></div>
        </div>
      </section>

      <!-- LMS: SISWA KERJAKAN SOAL -->
      <section id="lms" class="view hidden" aria-hidden="true">
        <div class="card">
          <h2>LMS — Kerjakan Soal</h2>

          <div style="display:grid;grid-template-columns:1fr 300px;gap:18px">
            <div>
              <label for="stu-name">Nama (lengkap)</label>
              <input id="stu-name" type="text" placeholder="Nama siswa">

              <label for="stu-class" style="margin-top:8px">Kelas</label>
              <select id="stu-class">
                <option>X TKJ 1</option>
                <option>X TKJ 2</option>
                <option>XI TKJ 1</option>
                <option>XI TKJ 2</option>
              </select>

              <div style="margin-top:12px">
                <button class="primary" onclick="startQuiz()">Mulai Quiz</button>
                <button class="ghost" onclick="clearStudentForm()">Bersihkan</button>
              </div>
              <div id="lms-msg" class="muted" style="margin-top:8px" aria-live="polite"></div>
            </div>

            <aside>
              <div class="card">
                <h4>Petunjuk</h4>
                <ol class="muted">
                  <li>Pastikan nama & kelas terisi sebelum memulai.</li>
                  <li>Quiz terdiri dari soal pilihan ganda; jawaban akan dinilai otomatis.</li>
                  <li>Hasil akan tersimpan dan dapat dilihat oleh admin.</li>
                </ol>
              </div>
            </aside>
          </div>
        </div>

        <!-- area quiz muncul di sini -->
        <div id="quiz-area" style="margin-top:18px;display:none" aria-live="polite"></div>
      </section>

      <!-- ADMIN PANEL -->
      <section id="admin" class="view hidden" aria-hidden="true">
        <div class="card" id="admin-login-card">
          <h2>Admin Login</h2>
          <label for="admin-user">Username</label>
          <input id="admin-user" type="text" placeholder="username">
          <label for="admin-pass" style="margin-top:8px">Password</label>
          <input id="admin-pass" type="password" placeholder="password">
          <div style="margin-top:12px"><button class="primary" onclick="adminLogin()">Login</button></div>
          <div id="admin-login-msg" class="muted" style="margin-top:10px" aria-live="polite"></div>
        </div>

        <div id="admin-panel" class="card hidden" aria-hidden="true">
          <h2>Admin Panel</h2>

          <h3>Absensi</h3>
          <div style="overflow:auto;max-height:220px">
            <table>
              <thead><tr><th>#</th><th>Nama</th><th>Kelas</th><th>Waktu</th><th>Aksi</th></tr></thead>
              <tbody id="admin-absensi"></tbody>
            </table>
          </div>

          <div style="height:12px"></div>
          <h3>Hasil Quiz</h3>
          <div style="overflow:auto;max-height:220px">
            <table>
              <thead><tr><th>#</th><th>Nama</th><th>Kelas</th><th>Skor</th><th>Waktu</th></tr></thead>
              <tbody id="admin-results"></tbody>
            </table>
          </div>

          <div style="margin-top:12px;display:flex;gap:8px">
            <button class="ghost" onclick="adminLogout()">Logout</button>
            <button class="ghost" onclick="exportAllCSV()">Export Semua CSV</button>
            <button class="ghost" onclick="clearAllData()">Hapus Semua Data</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- LOGIN MODAL PENGAJAR -->
  <div id="modalPengajar" class="modal-backdrop" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Login Pengajar</h3>
      <div class="muted" style="margin-bottom:8px">Masukkan username & password untuk masuk ke menu Pengajar.</div>
      <input id="modalUser" class="modal-input" type="text" placeholder="Username">
      <input id="modalPass" class="modal-input" type="password" placeholder="Password">
      <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
        <button class="ghost" onclick="closePengajarLogin()">Batal</button>
        <button class="primary" onclick="submitPengajarLogin()">Masuk</button>
      </div>
      <div id="modal-msg" class="muted" style="margin-top:10px;color:var(--red);display:none" aria-live="polite"></div>
    </div>
  </div>

  <script>
  /* =========================
     KEYS / HELPERS
     ========================= */
  const KEY_ABS = 'nevtik_absensi_v2';
  const KEY_Q   = 'nevtik_questions_v2';
  const KEY_RES = 'nevtik_results_v2';

  function loadFromStorage(key){
    try { return JSON.parse(localStorage.getItem(key) || '[]'); }
    catch(e) { return []; }
  }
  function saveToStorage(key, data){
    localStorage.setItem(key, JSON.stringify(data));
  }
  function escapeHtml(t){ return String(t||'').replace(/[&<>"']/g, s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[s])); }

  /* =========================
     NAVIGATION
     ========================= */
  function nav(view, btn){
    document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
    if(btn) btn.classList.add('active');
    document.querySelectorAll('.view').forEach(v=>v.classList.add('hidden'));
    const el = document.getElementById(view);
    if(el) el.classList.remove('hidden');

    // call updates for dynamic views
    if(view === 'absensi') renderRecentAbs();
    if(view === 'pengajar') renderQuestionList();
    if(view === 'admin') { /* nothing special here */ }
  }
  // show default
  nav('beranda', document.getElementById('nav-beranda'));

  /* =========================
     ABSENSI
     ========================= */
  function loadAbs(){ return loadFromStorage(KEY_ABS); }
  function saveAbs(a){ saveToStorage(KEY_ABS, a); }

  function submitAbsensi(){
    const name = document.getElementById('abs-nama').value.trim();
    const kelas = document.getElementById('abs-kelas').value;
    const msgEl = document.getElementById('abs-msg');
    msgEl.innerText = '';
    if(!name){ msgEl.innerText = 'Nama harus diisi'; return; }
    const arr = loadAbs();
    arr.push({name, kelas, time: new Date().toLocaleString()});
    saveAbs(arr);
    msgEl.innerText = 'Absensi berhasil dikirim.';
    document.getElementById('abs-nama').value = '';
    renderRecentAbs();
    setTimeout(()=>msgEl.innerText='',2500);
  }
  function clearAbsensiForm(){ document.getElementById('abs-nama').value=''; document.getElementById('abs-msg').innerText=''; }

  function renderRecentAbs(){
    const list = loadAbs();
    const el = document.getElementById('absensi-list');
    if(!list.length){ el.innerText = 'Belum ada data'; return; }
    const last = list.slice(-5).reverse();
    el.innerHTML = '<ol style="margin:0;padding-left:18px">'+ last.map(it => `<li>${escapeHtml(it.name)} — <small class="muted">${escapeHtml(it.kelas)} • ${escapeHtml(it.time)}</small></li>`).join('') +'</ol>';
  }

  /* =========================
     PENGAJAR: BANK SOAL
     ========================= */
  function loadQuestions(){ return loadFromStorage(KEY_Q); }
  function saveQuestions(qs){ saveToStorage(KEY_Q, qs); }

  function addQuestion(){
    const text = document.getElementById('q-text').value.trim();
    const opts = [
      document.getElementById('q-a0').value.trim(),
      document.getElementById('q-a1').value.trim(),
      document.getElementById('q-a2').value.trim(),
      document.getElementById('q-a3').value.trim()
    ];
    const correct = Number(document.getElementById('q-correct').value);
    const msg = document.getElementById('q-form-msg');
    msg.innerText = '';
    if(!text || opts.some(o=>!o)){ msg.innerText = 'Lengkapi soal dan semua pilihan'; return; }
    const qs = loadQuestions();
    qs.push({id: Date.now(), text, opts, correct});
    saveQuestions(qs);
    msg.innerText = 'Soal tersimpan.';
    clearQuestionForm();
    renderQuestionList();
    setTimeout(()=>msg.innerText='',2000);
  }

  function clearQuestionForm(){
    document.getElementById('q-text').value='';
    document.getElementById('q-a0').value='';
    document.getElementById('q-a1').value='';
    document.getElementById('q-a2').value='';
    document.getElementById('q-a3').value='';
    document.getElementById('q-correct').value='0';
  }

  function renderQuestionList(){
    const list = loadQuestions();
    const wrap = document.getElementById('question-list');
    if(!list.length){ wrap.innerHTML = '<div class="muted">Belum ada soal</div>'; return; }
    wrap.innerHTML = list.map((q, idx) => `
      <div style="padding:10px;border-bottom:1px solid #f2f2f2">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Q${idx+1}.</strong> ${escapeHtml(q.text)}</div>
          <div style="display:flex;gap:8px">
            <button class="ghost small" onclick="editQuestion(${q.id})">Edit</button>
            <button class="ghost small" onclick="deleteQuestion(${q.id})">Hapus</button>
          </div>
        </div>
        <div style="margin-top:8px;color:#555">${q.opts.map((o,i)=>`<span style="display:inline-block;margin-right:8px;padding:6px 8px;border-radius:6px;background:#fafafa;border:1px solid #eee">${String.fromCharCode(65+i)}. ${escapeHtml(o)}${i===q.correct ? ' ✓':''}</span>`).join('')}</div>
      </div>
    `).join('');
  }

  function deleteQuestion(id){
    if(!confirm('Hapus soal ini?')) return;
    const arr = loadQuestions().filter(s=>s.id!==id);
    saveQuestions(arr);
    renderQuestionList();
  }

  function editQuestion(id){
    const arr = loadQuestions();
    const q = arr.find(x=>x.id===id);
    if(!q) return;
    document.getElementById('q-text').value = q.text;
    document.getElementById('q-a0').value = q.opts[0];
    document.getElementById('q-a1').value = q.opts[1];
    document.getElementById('q-a2').value = q.opts[2];
    document.getElementById('q-a3').value = q.opts[3];
    document.getElementById('q-correct').value = q.correct.toString();
    // remove original to avoid duplicates on save
    const other = arr.filter(x=>x.id!==id);
    saveQuestions(other);
    renderQuestionList();
    document.getElementById('q-form-msg').innerText = 'Edit mode: ubah lalu klik "Tambah Soal" untuk menyimpan.';
    setTimeout(()=>document.getElementById('q-form-msg').innerText='',3500);
  }

  /* =========================
     LMS / QUIZ (SISWA)
     ========================= */
  let quizState = null; // {name, cls, answers:{qId:choice}, index, qlist}

  function clearStudentForm(){
    document.getElementById('stu-name').value='';
    document.getElementById('stu-class').selectedIndex = 0;
    document.getElementById('lms-msg').innerText='';
  }

  function startQuiz(){
    const name = document.getElementById('stu-name').value.trim();
    const cls = document.getElementById('stu-class').value;
    const questions = loadQuestions();
    const lmsMsg = document.getElementById('lms-msg');
    lmsMsg.innerText = '';
    if(!name){ lmsMsg.innerText = 'Masukkan nama lengkap'; return; }
    if(!questions.length){ lmsMsg.innerText = 'Belum ada soal. Hubungi pengajar.'; return; }
    quizState = {name, cls, answers:{}, index:0, qlist: JSON.parse(JSON.stringify(questions))}; // clone to avoid mutation
    renderQuizQuestion();
  }

  function renderQuizQuestion(){
    const area = document.getElementById('quiz-area');
    area.style.display = 'block';
    const q = quizState.qlist[quizState.index];
    const choicesHtml = q.opts.map((o,i) => {
      return `<label class="choice"><input type="radio" name="choice" value="${i}"> ${String.fromCharCode(65+i)}. ${escapeHtml(o)}</label>`;
    }).join('');
    area.innerHTML = `
      <div class="soal-box" role="region" aria-label="Soal">
        <div style="font-weight:700">Soal ${quizState.index+1} / ${quizState.qlist.length}</div>
        <p style="margin-top:8px">${escapeHtml(q.text)}</p>
        <div style="margin-top:10px">${choicesHtml}</div>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="primary" onclick="submitAnswer()">Jawab & Lanjut</button>
          <button class="ghost" onclick="cancelQuiz()">Batal</button>
        </div>
        <div id="quiz-note" class="muted" style="margin-top:8px"></div>
      </div>
    `;
  }

  function submitAnswer(){
    const sel = document.querySelector('input[name="choice"]:checked');
    const note = document.getElementById('quiz-note');
    note.innerText = '';
    if(!sel){ note.innerText = 'Pilih jawaban dulu'; return; }
    const choice = Number(sel.value);
    const q = quizState.qlist[quizState.index];
    quizState.answers[q.id] = choice;
    quizState.index++;
    if(quizState.index >= quizState.qlist.length){ finishQuiz(); } else { renderQuizQuestion(); }
  }

  function finishQuiz(){
    const qs = quizState.qlist;
    let correct = 0;
    qs.forEach(q=>{
      const a = quizState.answers[q.id];
      if(a === q.correct) correct++;
    });
    const score = Math.round((correct / qs.length) * 100);
    const results = loadFromStorage(KEY_RES) || [];
    results.push({id: Date.now(), name: quizState.name, cls: quizState.cls, score, time: new Date().toLocaleString()});
    saveToStorage(KEY_RES, results);

    document.getElementById('quiz-area').innerHTML = `<div class="card"><h3>Quiz selesai</h3><p>Nama: <strong>${escapeHtml(quizState.name)}</strong></p><p>Kelas: <strong>${escapeHtml(quizState.cls)}</strong></p><p>Skor: <strong>${score}</strong></p><p class="muted">Hasil tersimpan dan dapat dilihat oleh admin.</p><div style="margin-top:12px"><button class="primary" onclick="resetQuiz()">Selesai</button></div></div>`;
    quizState = null;
  }

  function resetQuiz(){
    document.getElementById('quiz-area').style.display = 'none';
    document.getElementById('quiz-area').innerHTML = '';
  }

  function cancelQuiz(){ if(confirm('Batal quiz?')){ quizState=null; resetQuiz(); } }

  /* =========================
     ADMIN PANEL (login + view results)
     ========================= */
  // Credentials (you requested me to set)
  const ADMIN_CRED = {user:'admin', pass:'12345'};
  const TEACHER_CRED = {user:'pengajar', pass:'guru123'};

  function adminLogin(){
    const u = document.getElementById('admin-user').value.trim();
    const p = document.getElementById('admin-pass').value.trim();
    const msg = document.getElementById('admin-login-msg');
    msg.innerText = '';
    if(u === ADMIN_CRED.user && p === ADMIN_CRED.pass){
      document.getElementById('admin-login-card').classList.add('hidden');
      document.getElementById('admin-panel').classList.remove('hidden');
      renderAdminTables();
      // highlight nav
      nav('admin', document.getElementById('nav-admin'));
    } else {
      msg.innerText = 'Username / password salah';
    }
  }

  function adminLogout(){
    document.getElementById('admin-login-card').classList.remove('hidden');
    document.getElementById('admin-panel').classList.add('hidden');
    document.getElementById('admin-user').value = "";
    document.getElementById('admin-pass').value = "";
    document.getElementById('admin-login-msg').innerText = "";
    // go home
    nav('beranda', document.getElementById('nav-beranda'));
  }

  function renderAdminTables(){
    // absensi
    const abs = loadAbs();
    const t = document.getElementById('admin-absensi');
    t.innerHTML = '';
    abs.forEach((a,i)=>{
      t.innerHTML += `<tr>
        <td>${i+1}</td>
        <td>${escapeHtml(a.name)}</td>
        <td>${escapeHtml(a.kelas)}</td>
        <td>${escapeHtml(a.time)}</td>
        <td><button class="ghost small" onclick="adminDeleteAbs(${i})">Hapus</button></td>
      </tr>`;
    });
    // results
    const res = loadFromStorage(KEY_RES) || [];
    const r = document.getElementById('admin-results');
    r.innerHTML = '';
    res.forEach((it, i)=>{
      r.innerHTML += `<tr>
        <td>${i+1}</td>
        <td>${escapeHtml(it.name)}</td>
        <td>${escapeHtml(it.cls)}</td>
        <td>${it.score}</td>
        <td>${escapeHtml(it.time)}</td>
      </tr>`;
    });
  }

  function adminDeleteAbs(i){
    if(!confirm('Hapus data absensi ini?')) return;
    const arr = loadAbs();
    arr.splice(i,1);
    saveAbs(arr);
    renderAdminTables();
    renderRecentAbs();
  }

  function clearAllData(){
    if(!confirm('Hapus semua data (absensi, soal, hasil)?')) return;
    localStorage.removeItem(KEY_ABS);
    localStorage.removeItem(KEY_Q);
    localStorage.removeItem(KEY_RES);
    renderQuestionList();
    renderAdminTables();
    renderRecentAbs();
    alert('Semua data dihapus');
  }

  /* =========================
     EXPORT CSV
     ========================= */
  function exportCSV(filename, rows){
    if(!rows || !rows.length){ alert('Tidak ada data untuk diexport'); return; }
    const keys = Object.keys(rows[0]);
    const csv = [keys.join(',')].concat(rows.map(r => keys.map(k => `"${String(r[k]||'').replace(/"/g,'""')}"`).join(','))).join('\n');
    const blob = new Blob([csv], {type:'text/csv'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
    setTimeout(()=>URL.revokeObjectURL(a.href), 5000);
  }

  function exportAllCSV(){
    const abs = loadAbs();
    const res = loadFromStorage(KEY_RES) || [];
    if(abs.length) exportCSV('absensi.csv', abs.map((a,i)=>({no:i+1,nama:a.name,kelas:a.kelas,waktu:a.time})));
    if(res.length) exportCSV('hasil_quiz.csv', res.map((r,i)=>({no:i+1,nama:r.name,kelas:r.cls,skor:r.score,waktu:r.time})));
    if(!abs.length && !res.length) alert('Tidak ada data untuk diexport');
  }

  /* =========================
     PENGAJAR LOGIN MODAL
     ========================= */
  let pendingNavButton = null;

  function openPengajarLogin(btn){
    if(btn) pendingNavButton = btn;
    document.getElementById('modalPengajar').style.display = 'flex';
    document.getElementById('modal-msg').style.display = 'none';
    document.getElementById('modalUser').value = '';
    document.getElementById('modalPass').value = '';
    setTimeout(()=>document.getElementById('modalUser').focus(),100);
  }

  function closePengajarLogin(){
    document.getElementById('modalPengajar').style.display = 'none';
    pendingNavButton = null;
  }

  function submitPengajarLogin(){
    const u = document.getElementById('modalUser').value.trim();
    const p = document.getElementById('modalPass').value.trim();
    const msgEl = document.getElementById('modal-msg');
    msgEl.innerText = '';
    if((u === TEACHER_CRED.user && p === TEACHER_CRED.pass) || (u === ADMIN_CRED.user && p === ADMIN_CRED.pass)){
      // session role (tab-only)
      const role = (u === TEACHER_CRED.user) ? 'pengajar' : 'admin';
      sessionStorage.setItem('nevtik_role', role);
      document.getElementById('peng-logout-btn').classList.remove('hidden');
      closePengajarLogin();
      const btn = pendingNavButton || document.getElementById('nav-pengajar');
      nav('pengajar', btn);
      pendingNavButton = null;
    } else {
      msgEl.innerText = 'Username atau password salah';
      msgEl.style.display = 'block';
    }
  }

  function pengajarLogout(){
    sessionStorage.removeItem('nevtik_role');
    document.getElementById('peng-logout-btn').classList.add('hidden');
    nav('beranda', document.getElementById('nav-beranda'));
  }

  (function initPengajarSession(){
    const role = sessionStorage.getItem('nevtik_role');
    if(role === 'pengajar' || role === 'admin'){
      document.getElementById('peng-logout-btn').classList.remove('hidden');
    }
  })();

  /* =========================
     INIT
     ========================= */
  // initial render
  renderQuestionList();
  renderRecentAbs();

  // accessibility: close modal on ESC
  window.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape'){
      const modal = document.getElementById('modalPengajar');
      if(modal && modal.style.display === 'flex') closePengajarLogin();
    }
  });

  </script>
</body>
</html>
